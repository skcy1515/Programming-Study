# 프로세스 간 통신
프로세스는 독립적으로 실행되기도 하지만 다른 프로세스와
데이터를 주고 받으며 통신을 하는 경우도 있다. 

통신은 한 컴퓨터 내에서 실행되고 있는 다른 프로세스와 할 수도 있고, 네트워크로 연결된 다른 컴퓨터에 있는 프로세스와 통신을 할 수도 있다.

### 통신의 종류
- 한 컴퓨터 내에서 프로세스 간 통신
	- 파일: 통신하려는 프로세스들이 하나의 파일을 이용해 읽고 쓰는 방법
	- 파이프: 운영체제가 생성한 파이프를 이용해 데이터를 읽고 쓰는 방법
- 한 프로세스 내에서 쓰레드 간 통신: 쓰레드는 코드, 데이터, 힙영역을 공유하고 스택은 각자 자기의 것을 가지고 있으므로, 데이터 영역에 있는 전역 변수나 힙을 이용해 통신
- 네트워크를 이용한 방법: 운영체제가 제공하는 소켓 통신이나 다른 컴퓨터에 있는 함수를 호출하는 RPC(원격 프로시저 호출)을 이용해 통신

# 공유자원과 임계구역
프로세스 간 통신을 할 때 공동으로 이용하는 변수나 파일들이 있는데 이런 것들을 공유자원이라 한다.

공유자원은 여러 프로세스가 공유하고 있기 때문에 각 프로세스의 접근 순서에 따라 결과가 달라질 수 있다. 또한 컨텍스트 스위칭으로 시분할 처리를 하기 때문에 어떤 프로세스가 먼저 실행되고 어떤 프로세스가 나중에 실행되는지 예측하기가 힘들다. 따라서 연산 결과를 예측하기 힘들고 여기서 발생한 문제를 `동기화 문제`라고 부른다.

![image](https://github.com/skcy1515/Programming-Study/assets/140364849/ae59e0c1-17eb-4501-8b88-311b7f575c73)

게임을 예시로, CPU 스케줄러에 의해 공격받는 코드가 먼저 실행됐다고 가정한다. 두 번째줄에 있는 코드가 실행되어 currentHealth에 20이 저장되고 컨텍스트 스위칭이 일어나서 물약을 먹는 코드가 실행되어 currentHealth에 20이 저장되고 그 다음 코드를 실행하여 health를 70으로 변경, 그 다음 컨텍스트 스위칭이 일어나서 그 다음 코드를 실행하면 health가 currentHealth에서 10을 빼서 10이 된다. 물약을 먹고 공격을 받아 health가 60이 되어야 하는데 이렇게 된 이유는 health라는 공유 자원을 여러 프로세스가 동시에 사용했기 때문이다.

따라서 여러 프로세스가 동시에 사용하면 안되는 영역을 정의했는데 이를 `임계구역`이라고 한다.

임계구역에서 일어나는 문제들을 해결하기 위해서는 상호 배제 메커니즘이 필요하다. 상호 배제 메커니즘의 요구사항은 세가지가 있다.
- 임계영역엔 동시에 하나의 프로세스만 접근한다.
- 여러 요청에도 하나의 프로세스의 접근만 허용한다.
- 임계구역에 들어간 프로세스는 빠르게 나와야한다.

# 세마포어
상호배제 메커니즘의 한 종류

컴퓨터 A와 컴퓨터 B가 공유자원인 프린터를 동시에 출력하는 명령을 보냄. 그러면 컴퓨터 A와 B가 프린터를 차지하기 위해 경쟁 조건이 되어버리고 이러면 프린트의 결과물이 A와 B 섞여서 나오기 때문에 쓸모가 없어짐. 이런 상황을 막기 위해 프린터실을 따로 만들고, 컴퓨터와 프린터를 설치 그리고 밖에는 이 방을 관리하는 열쇠 관리자를 둠. 여기서 프린트를 하고 싶으면 열쇠 관리자에게 열쇠를 받아 프린트 방에 들어가서 프린트를 하게 되고 만약 또 다른 작업이 들어오면 먼저 들어갔던 작업이 끝날 때까지 뒤에 온 작업은 대기함.

이런 예시를 세마포어 메커니즘이라고 부른다.

![image](https://github.com/skcy1515/Programming-Study/assets/140364849/bdf88aff-4bef-46d0-bd1a-b2742568ec23)

- 프로세스: 프린터를 사용하려는 직원 (컴퓨터)
- 공유자원: 프린터
- 대기 큐: 프린터를 쓰기 위해 프로세스가 기다리는 공간
- 운영체제: 열쇠 관리자
- 세마포어: 열쇠

![image](https://github.com/skcy1515/Programming-Study/assets/140364849/491cdd05-6166-4379-a80e-f43250fa5203)

![image](https://github.com/skcy1515/Programming-Study/assets/140364849/39e352be-c324-433f-8007-cd168d440931)

![image](https://github.com/skcy1515/Programming-Study/assets/140364849/11245813-9dab-4969-89e7-a6288f67e3c0)

세마포어 코드 예시 (세마포어가 1이면 공유 자원이 1개, 2면 2개)

# 모니터
세마포어 메커니즘의 단점을 해결한 상호배제 메커니즘, 모니터는 운영체제에서 지원하는 방법이 아니라 프로그래밍 언어 차원에서 지원하는 방법

![image](https://github.com/skcy1515/Programming-Study/assets/140364849/52b04399-a125-46ae-8541-84b31ad6bf7d)

자바의 예시, 자바에서 synchronized 함수가 붙으면 동시에 여러 프로세스에서 실행시킬 수 없다.

모니터의 구현만 완벽하다면 프로그래머는 세마포어처럼 wait() 함수나 signal() 함수를 임계영역에 감싸지 않아도 돼서 편리하고 안전하게 코드를 작성할 수 있다.
